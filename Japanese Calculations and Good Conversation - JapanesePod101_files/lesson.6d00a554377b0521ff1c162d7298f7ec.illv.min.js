!function(r){window.Ill||(window.Ill={}),window.Ill.navigation||(window.Ill.navigation={}),window.Ill.navigation.init=function(){var e=r(".js-r101-navigation--b");if(!e.length)return!1;var t=e.closest(".js-r101-navigation-anchor"),n=t.length?t.height():0,a=!1,s=980<=r(window).width()&&r(".js-pathway-context-bar").length?r(".js-pathway-context-bar").outerHeight():0;t.length&&(r(".js-r101-navigation--b a").on("click",function(){var e,t;return e=r(this).attr("href"),t=n,a=!0,r(".js-r101-navigation--b li").removeClass("r101-navigation__current"),r(".js-r101-navigation--b a[href="+e+"]").closest("li").addClass("r101-navigation__current"),window.scrollTo(0,r(e+("dialogue"===e.substr(1)?"_0":"")).offset().top-t-s),setTimeout(function(){a=!1},100),!1}),r(document).on("scroll resize orientationchange",function(){s=980<=r(window).width()&&r(".js-pathway-context-bar").length?r(".js-pathway-context-bar").outerHeight():0,r(document).scrollTop()>t.offset().top-s?e.addClass("r101-navigation--b__fixed"):e.removeClass("r101-navigation--b__fixed"),a||r(".js-r101-navigation--b a").each(function(){var e=r(this).attr("href"),t=r(e+("dialogue"===e.substr(1)?"_0":""));null!==e.match(/^#[^#]+/g)&&t.length&&t.offset().top<=r(document).scrollTop()+n&&t.offset().top+t.outerHeight(!0)>r(document).scrollTop()+n?(r(".js-r101-navigation--b li").removeClass("r101-navigation__current"),r(this).closest("li").addClass("r101-navigation__current")):r(this).closest("li").removeClass("r101-navigation__current")})}))},r(window.Ill.navigation.init)}(jQuery);var percentage,letterGrade,i,arrAnswers,arrIncorrect,arr_ids,totalQuestions=0,totalCorrect=0,totalIncorrect=0;function deletePunctuation(e){return e.replaceAll(".","").replaceAll(",","").replaceAll("!","").replaceAll("?","").replaceAll(":","")}function lCase(e){return(e=deletePunctuation(e)).toLowerCase()}function updateAnswer(e,t){getObj("answer_"+t).value=e.value}function checkQuizAnswers(e,t,n){jQuery(e).hasClass("disabled")||(checkAnswers(),t&&"function"==typeof GALocalEventTracking&&GALocalEventTracking(["_trackEvent",t,n,percentage]))}function calculateTotals(){90<=(percentage=Math.floor(totalCorrect/totalQuestions*100))&&(letterGrade="A"),percentage<90&&80<=percentage&&(letterGrade="B"),percentage<80&&70<=percentage&&(letterGrade="C"),percentage<70&&60<=percentage&&(letterGrade="D"),percentage<60&&(letterGrade="F"),getObj("percentage_testing").innerHTML=percentage+"%",getObj("letter_testing").innerHTML=letterGrade,getObj("score_testing").className="showing",getObj("showAnswersBtn").className="showing",disableInputs(),jQuery("#checkAnswersBtn").addClass("disabled"),jQuery.scrollTo&&jQuery.scrollTo("#percentage_testing",{duration:1e3,offset:-25})}function hideScrores(){getObj("score_testing").className="hiding",getObj("showAnswersBtn").className="hiding"}function resetTest(e){letterGrade=percentage="",totalCorrect=0,enableInputs(),jQuery("#checkAnswersBtn").removeClass("disabled"),"y"==e&&(totalIncorrect=0,arrIncorrect=new Array)}function clearColors(){for(x=0;x<totalQuestions;x++)colorIt(x,"clear")}function getObj(e){return document.getElementById(e)}function colorIt(e,t){getObj("question_block_"+e).className="answer_"+t}function hideAnswers(){for(i=0;i<totalQuestions;i++)getObj("correct_answer_"+i).innerHTML=""}function getName(e){return document.getElementsByName(e)}function disableInputs(){for(i=0;i<totalQuestions;i++)if(getObj("answer_"+i).disabled=!0,""==arrAnswers[i])for(x=0;x<getName("question_"+i).length;x++)getName("question_"+i)[x].disabled=!0}function enableInputs(){for(i=0;i<totalQuestions;i++)if(getObj("answer_"+i).disabled=!1,""==arrAnswers[i])for(x=0;x<getName("question_"+i).length;x++)getName("question_"+i)[x].disabled=!1}function hideMeAndShowReset(){getObj("showAnswersBtn").className="hidingdisplay"}function uncheckRadioInContainer(e){jQuery(e).find("input:radio").attr("checked",!1),jQuery(e).find("input:hidden.answer").each(function(){jQuery(this).val("")}),jQuery(e).find("input:text").each(function(){jQuery(this).val("")}),jQuery(e).find(".radio-checked").removeClass("radio-checked")}function checkAnswers(){for(var e=totalIncorrect=totalCorrect=0;e<totalQuestions;e++)"correct"==getObj("answer_"+e).value||lCase(arrAnswers[e])==lCase(jQuery.trim(getObj("answer_"+e).value))&&""!=lCase(getObj("answer_"+e).value)||"E"!=jQuery("#quizz_settings option:selected").val()&&-1!=lCase(arrAnswers[e]).indexOf(lCase(getObj("answer_"+e).value))&&""!=lCase(getObj("answer_"+e).value)?(totalCorrect++,colorIt(e,"green")):(arrIncorrect[totalIncorrect]=e,totalIncorrect++,colorIt(e,"red"));calculateTotals()}function showRightAnswers(){for(var e=0;e<totalIncorrect;e++)if(""==arrAnswers[arrIncorrect[e]]||arrAnswers[arrIncorrect[e]]in{a:1,b:2,c:3,d:4,e:5,f:6,g:7})if(1==arrAnswers[arrIncorrect[e]].length)null!=getObj("option_"+arrAnswers[arrIncorrect[e]])&&(getObj("correct_answer_"+arrIncorrect[e]).innerHTML="&nbsp;&nbsp;&nbsp;"+getObj("option_"+arrAnswers[arrIncorrect[e]]).innerHTML.substring(3));else for(var t=0;t<getName("question_"+arrIncorrect[e]).length;t++)"correct"==getName("question_"+arrIncorrect[e])[t].value&&(getObj("correct_answer_"+arrIncorrect[e]).innerHTML="&nbsp;&nbsp;&nbsp;"+getObj("answer_key_"+arrIncorrect[e]+"_"+t).innerHTML);else getObj("correct_answer_"+arrIncorrect[e]).innerHTML="&nbsp;&nbsp;&nbsp;"+arrAnswers[arrIncorrect[e]]}function lessonKanjiFlashcards(e,t){var n=jQuery("#"+t);jQuery.post(e,n.serialize(),function(e){n.closest(".js-lsn3-kanji-quiz-html").html(e)}).fail(function(){alert("Server doesn't response. Please contact us.")})}String.prototype.replaceAll=function(e,t){return this.split(e).join(t)};var currentQuestion,currentAnswer,arr_vocab=[],int_correct=0,int_incorrect=0,int_testtype="Arabic",int_testval=0,start_ans_num=0,bUpdateStats=!1;function fShowAll(){document.getElementById("question_").innerHTML=currentQuestion,document.getElementById("answer_").innerHTML=currentAnswer,document.getElementById("button_yes").disabled=!1,document.getElementById("button_no").disabled=!1}function fHideAll(){document.getElementById("question_").innerHTML=currentQuestion,document.getElementById("answer_").innerHTML="",document.getElementById("button_yes").disabled=!0,document.getElementById("button_no").disabled=!0}function fYes(){bUpdateStats&&makeRequest(request_url+"yes/"+arr_ids[arr_ids.length-1]),bUpdateStats&&arr_ids.pop();for(var e=0;e<arr_vocab.length;e++)arr_vocab[e].pop();int_correct++,fUpdateInfo(),fShowNextCard()}function fNo(){bUpdateStats&&makeRequest(request_url+"no/"+arr_ids[arr_ids.length-1]),int_incorrect++,fUpdateInfo(),fShowNextCard()}function fUpdateInfo(){document.getElementById("div_CardsLeft").innerHTML="Cards left: "+arr_vocab[int_testval].length,document.getElementById("div_Correct").innerHTML="Correct: "+int_correct,document.getElementById("div_Incorrect").innerHTML="Incorrect: "+int_incorrect}function fEndTest(){document.getElementById("div_CardsLeft").innerHTML="Done!",document.getElementById("button_yes").disabled=!0,document.getElementById("button_no").disabled=!0,document.getElementById("button_show").disabled=!0}function fShowNextCard(){if(0!=arr_ids.length){for(var e,t,n=arr_vocab[int_testval].length-1,a=Math.floor(Math.random()*(1+n)),s=0;s<arr_vocab.length;s++)e=arr_vocab[s][n],t=arr_vocab[s][a],arr_vocab[s][n]=t,arr_vocab[s][a]=e;if(bUpdateStats&&(e=arr_ids[n],t=arr_ids[a],arr_ids[n]=t,arr_ids[a]=e),fHideAll(),start_ans_num=0,"Audio"!=int_testtype){currentQuestion=arr_vocab[int_testval][arr_vocab[int_testval].length-1],start_ans_num=0,(currentAnswer="")==currentQuestion&&(currentQuestion=arr_vocab[0][arr_vocab[0].length-1],start_ans_num=1);for(s=start_ans_num;s<arr_vocab.length-1;s++)s!=int_testval&&""!=arr_vocab[s][arr_vocab[s].length-1]&&(currentAnswer=currentAnswer+arr_vocab[s][arr_vocab[s].length-1]+"<br><br>");"NULL"!=arr_vocab[arr_vocab.length-1][arr_vocab[arr_vocab.length-1].length-1]&&(currentAnswer=currentAnswer+'<img src="/learningcenter/images/audio.gif" onclick="'+arr_vocab[arr_vocab.length-1][arr_vocab[arr_vocab.length-1].length-1]+'" border="0" height="22" width="22" alt="listen" />')}else{start_ans_num="NULL"!=arr_vocab[int_testval][arr_vocab[int_testval].length-1]?(currentQuestion='<img src="/learningcenter/images/audio.gif" onclick="'+arr_vocab[int_testval][arr_vocab[int_testval].length-1]+'" border="0" height="22" width="22" alt="listen" />',0):(currentQuestion=arr_vocab[0][arr_vocab[0].length-1],1),currentAnswer="";for(s=start_ans_num;s<arr_vocab.length-1;s++)""!=arr_vocab[s][arr_vocab[s].length-1]&&(currentAnswer=currentAnswer+arr_vocab[s][arr_vocab[s].length-1]+"<br><br>")}var r=document.getElementById("question_"),i=14<80-4*currentQuestion.length?80-4*currentQuestion.length:16;r.style.fontSize=i+"px",r.innerHTML=currentQuestion,document.getElementById("answer_").innerHTML=""}else fEndTest()}function makeRequest(e){var t=!1;if(window.XMLHttpRequest)(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml");else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(!t)return!1;t.onreadystatechange=function(){alertContents(t)},t.open("GET",e,!0),t.send(null)}function alertContents(e){4==e.readyState&&e.status}function IllMarkLessonComplete(t,a){function s(e){return e.hasClass("checked")?(e.removeClass("checked"),e.attr("aria-checked","false"),".js-fl-complete-button"===t&&e.html("Mark Complete")):(e.addClass("checked"),e.attr("aria-checked","true"),".js-fl-complete-button"===t&&e.html("Completed")),e.hasClass("checked")}var e=jQuery(t);e.attr("role","checkbox"),e.each(function(e,t){(t=jQuery(t)).attr("aria-checked",t.hasClass("checked")?"true":"false")}),e.bind("touchend click",function(e){e.preventDefault();var t=jQuery(this).data("lessonid")||0,e=s(jQuery(this)),n=this;if(!t)return!1;jQuery(n).attr("disabled",!0),jQuery.post("/api/lesson/complete/"+t,{is_completed:+e}).success(function(e){e&&"success"===e.status&&(s(jQuery(this)),jQuery(n).removeAttr("disabled"),"function"==typeof a&&a(n))}).fail(function(){s(jQuery(this)),jQuery(n).removeAttr("disabled"),"function"==typeof a&&a(n)})})}function IllFavouritesLessons(s,r,i,o,l){var e=jQuery(s);l&&(e.attr("role","checkbox"),e.each(function(e,t){(t=jQuery(t)).attr("aria-checked",t.hasClass("yes")?"true":"false")})),e.bind("touchend click",function(e){e.preventDefault();var t=jQuery(this).data("lessonid")||0,n=((e=jQuery(this)).hasClass("yes")?(e.removeClass("yes"),l&&e.attr("aria-checked","false"),".js-nl-favorite-button"===s&&e.text("Add to Favorites")):(e.addClass("yes"),l&&e.attr("aria-checked","true"),".js-nl-favorite-button"===s&&e.text("In Favorites")),e.hasClass("yes")),a=this;if(!t)return!1;jQuery.post("/api/lesson/bookmark/"+t,{is_bookmarked:+n}).success(function(e){n?"function"==typeof r&&r(e,a):"function"==typeof i&&i(e,a)}).fail(function(){"function"==typeof o&&o("Server connection error. Try again.",a)})})}!function(c){c.fn.illProgressBar=function(l,e,t,n){return this.each(function(){n=!1!==n,c(this).data("colors",n),c(this).data("total",e),c(this).data("complete",t),c(this).on("illupdate",function(e,t){var n=c(this).find(".js-progress-done, .r101-progress__done"),a=parseInt(c(this).data("total")),s=parseInt(c(this).data("complete")),r=c(this).data("colors"),i=0,o="";void 0!==t&&(void 0!==t.c?s=parseInt(t.c):s+=parseInt(t)),0===s||0===a?i=0:a<=s?i=100:100<=(i=Math.ceil(s/a*100))&&(i=99),i<0&&(i=0),100<i&&(i=100),n.css("width",i+"%"),r&&(o=i<30?"#f27a73":i<90?"#f8ad55":"#9bcb7d",n.css("background-color",o));o=l.replace(/\{([pct])\}/g,function(e,t){switch(t){case"p":return i;case"c":return s;case"t":return a}});c(this).find(".js-progress-text, .r101-progress__inline").text(o)})}),this.trigger("illupdate"),this}}(jQuery),jQuery(function(n){n(document).on("click",".js-lsn3-dialogue ul li a",function(){var e=n(this).closest("li"),t=e.attr("aria-controls");if(e.hasClass("r101-navigation__current"))return!1;e.siblings("li").removeClass("r101-navigation__current"),e.siblings("li").attr("aria-selected","false"),e.addClass("r101-navigation__current"),e.attr("aria-selected","true"),e.closest(".js-lsn3-dialogue").find("div section").hide(),e.closest(".js-lsn3-dialogue").find("div section").attr("aria-hidden","true"),e.closest(".js-lsn3-dialogue").find("div section .js-lsn3-tabindex").attr("tabindex","-1"),n("#"+t).show(),n("#"+t).attr("aria-hidden","false"),n("#"+t+" .js-lsn3-tabindex").attr("tabindex","0")})}),jQuery(function(n){n(document).on("click",".js-lsn3-vocabulary ul li a",function(){var e=n(this).closest("li"),t=e.attr("aria-controls");if(e.hasClass("r101-navigation__current"))return!1;e.siblings("li").removeClass("r101-navigation__current"),e.siblings("li").attr("aria-selected","false"),e.addClass("r101-navigation__current"),e.attr("aria-selected","true"),e.closest(".js-lsn3-vocabulary").find("div section").hide(),e.closest(".js-lsn3-vocabulary").find("div section").attr("aria-hidden","true"),e.closest(".js-lsn3-vocabulary").find("div section .js-lsn3-tabindex").attr("tabindex","-1"),n("#"+t).show(),n("#"+t).attr("aria-hidden","false"),n("#"+t+" .js-lsn3-tabindex").attr("tabindex","0")})}),function(C){function p(){return C(".js-lsn3-lesson").data("wp-post-id")}function f(){return C(".js-lsn3-lesson").data("lc-lesson-id")}function v(e,t){C(this).focus();var n=C(".js-fla-popup").clone().removeClass("js-fla-popup");n.find("#fla-popup-title").removeAttr("id"),n.find("[data-feature]").css("display","none"),n.find("[data-feature="+e+"]").css("display","block"),n.find("header h1[data-feature="+e+"]").attr("id","fla-popup-title"),n.find(".js-fla-popup-description i").removeClass().addClass("icn-feature-"+e),n.css("display","block"),n.css("display","block"),(e=new window.Ill.LightBoxOptions).boxClass="feature",new window.Ill.LightBoxPopup(e).show(n)}var g=13,m=40;C(document).on("click",".js-lsn3-show-sign-up",function(){v(C(this).data("feature"),document.activeElement)}),C(document).on("click",".js-lsn3-play-dialogue, .js-lsn3-play-vocabulary",function(){var e='<audio preload="none" controls'+(C(this).data("speed")?' data-speed="0.5"':"")+'><source src="'+C(this).data("src")+'" type="'+C(this).data("type")+'"></audio>';C(this).after(e),C(this).attr("tabindex","-1").hide(),C(this).siblings("audio").mediaelementplayer({pluginPath:"/static/js/mediaelementjs/build/",classPrefix:"mejsa__",audioWidth:25,audioHeight:25,startVolume:1,alwaysShowControls:!0,features:["playpause"],enableProgressTooltip:!1,playText:"Play",pauseText:"Pause",isVideo:!1,success:function(e,t){var n=C(t).closest(".mejsa__container").find(".mejsa__playpause-button");n.length&&(e.addEventListener("play",function(){n.removeClass("mejsa__loading")}),e.addEventListener("playing",function(){n.removeClass("mejsa__loading")}),e.addEventListener("seeking",function(){n.addClass("mejsa__loading")}),e.addEventListener("seeked",function(){n.removeClass("mejsa__loading")}),e.addEventListener("pause",function(){n.removeClass("mejsa__loading")}),e.addEventListener("waiting",function(){n.addClass("mejsa__loading")}),e.addEventListener("loadeddata",function(){n.addClass("mejsa__loading")}),e.addEventListener("canplay",function(){n.removeClass("mejsa__loading")}),e.addEventListener("error",function(){n.removeClass("mejsa__loading")})),e.load(),C(t).data("speed")&&(e.playbackRate=C(t).data("speed")),e.play()}})}),window.Ill||(window.Ill={}),window.Ill.lesson||(window.Ill.lesson={}),window.Ill.lesson.init=function(){C(".js-lsn3-show-sign-up").bind("keydown",function(e){switch(e.which){case g:case m:return v(C(this).data("feature"),document.activeElement),e.preventDefault(),e.stopPropagation(),!1}});var t=!!C(".js-lsn3-lesson-public-ui").length,n=!!C(".js-lsn3-lesson-private-ui").length,a=!!C(".js-lsn3-has-premium-access").length,s=!!C(".js-lsn3-is-logined").length;function i(){return'<div style="display:table;width:100%;"><div style="display:table-cell;width:100%;height:400px;vertical-align:middle;text-align:center;"><span style="display: inline-block;" class="r101-spinner--a"></span></div></div>'}C("#lsn3-lesson-transcript-table tr:gt(10)").length&&(C(".js-lsn3-toggle-lesson-transcript").parent().show(),C(".js-lsn3-toggle-lesson-transcript").bind("click",function(){var e=C(this);"true"==e.attr("aria-expanded")?(e.text(e.data("show")),e.attr("aria-expanded","false")):(e.text(e.data("hide")),e.attr("aria-expanded","true")),C("#lsn3-lesson-transcript-table tr:gt(10)").toggle()}),n&&C(".js-lsn3-toggle-lesson-transcript").trigger("click")),C(".js-lsn3-fix-th table tr:first-child").each(function(){var e=C(this).find("td").length,t=C(this).find("td>p>strong, td>p>em>strong, td>p>span>strong, td>strong");t.length==e&&t.closest("td").addClass("lsn3-th")}),C(".js-lsn3-show-my-notes").click(function(){var e=C(".js-lsn3-notes").clone().removeClass("js-lsn3-notes"),t=C(this);t.addClass("active"),e.find(".js-lsn3-notes-html").html(i()),e.css("display","block");var n=new window.Ill.LightBoxOptions;n.boxClass="quiz",n.closeButton=!0,n.validateFunc=function(e){e=e.find("button");return!(e.length&&!e.attr("disabled")&&!confirm("Your changes have not been saved. Are you sure you want to close?"))};var a=new window.Ill.LightBoxPopup(n);a.on("beforeShow",function(e){var s,r,i;s=e,r=a,i="/learningcenter/lessons/:id/notes3".replace(":id",f()),C.get(i,function(e){s.find(".js-lsn3-notes-html").html(e);var t=s.find("textarea"),n=s.find("#saveLessonNotes"),a=t.val();n.attr("disabled",!0),n.bind("click",function(){var e=C(this);e.prop("disabled",!0),C.post(i,s.find("form").serialize()).fail(function(){alert("Couldn't save lesson notes.")}).done(function(){3e4<t.val().length?alert("The size of each note must not exceed 30 000 characters!"):(a=t.val(),e.attr("disabled",!0),r.close())})}),t.bind("keyup change",function(){n.attr("disabled",this.value==a)})})}),a.on("onClose",function(){e.find(".js-lsn3-notes-quiz").html(""),t.removeClass("active")}),a.show(e)}),C(".js-lsn3-take-vocabulary-quiz").click(function(e,t){C(this).focus(),t=t||".js-lsn3-review-questions";var n=C(".js-lsn3-quiz").clone().removeClass("js-lsn3-quiz"),a=C(this);a.prop("disabled",!0),n.find(".js-lsn3-quiz-html").html(i());var s=new window.Ill.LightBoxOptions;s.boxClass="quiz",s.closeButton=!0;s=new window.Ill.LightBoxPopup(s);s.on("beforeShow",function(r){r.on("click",".js-lsn3-quiz-navigation a",function(){var t,n,a,e=C(this).closest("li"),s=r.children();if(e.hasClass("r101-navigation__current"))return!1;e.siblings("li").removeClass("r101-navigation__current"),e.addClass("r101-navigation__current"),s.find(".js-lsn3-quiz-html").html(i()),e.hasClass("js-lsn3-quizz-settings")?((a=s).css("display","block"),C.get("/learningcenter/account/quizzsettings3",function(e){a.find(".js-lsn3-quiz-html").html(e),a.find(".js-lsn3-save-quiz-settings").click(function(){var e=C(this);e.prop("disabled",!0),C.ajax({url:"/learningcenter/account/quizzsettingssave",type:"POST",data:{questions:a.find(".js-lsn3-quiz-settings-questions option:selected").val()},dataType:"json"}).done(function(e){e&&e.success||alert("Ah error has occurred. Quizz Settings #1")}).fail(function(){alert("Ah error has occurred. Quizz Settings #2")}).always(function(){e.prop("disabled",!1)})})})):e.hasClass("js-lsn3-writing-questions")?((n=s).css("display","block"),C.get("/learningcenter/lessons/:id/writing_tests3".replace(":id",f()),function(e){n.find(".js-lsn3-quiz-html").html(e)})):e.hasClass("js-lsn3-review-questions")&&((t=s).css("display","block"),C.get("/learningcenter/lessons/:id/review_tests3".replace(":id",f()),function(e){t.find(".js-lsn3-quiz-html").html(e)}))}),n.find(".js-lsn3-quiz-navigation "+t+" a:first").click()}),s.on("onClose",function(){n.find(".js-lsn3-quiz-html").html(""),a.prop("disabled",!1)}),s.show(n)}),"#lc_review_tests"===window.location.hash||"#quizzes"===window.location.hash?C(".js-lsn3-take-vocabulary-quiz").trigger("click",".js-lsn3-review-questions"):"#lc_writing_tests"===window.location.hash?C(".js-lsn3-take-vocabulary-quiz").trigger("click",".js-lsn3-writing-questions"):"#lc_quizz_settings"===window.location.hash&&C(".js-lsn3-take-vocabulary-quiz").trigger("click",".js-lsn3-quizz-settings"),C(".js-lsn3-take-kanji-quiz").click(function(){C(this).focus();var e=C(".js-lsn3-kanji-quiz").clone().removeClass("js-lsn3-kanji-quiz"),t=C(this);t.prop("disabled",!0),e.find(".js-lsn3-kanji-quiz-html").html(i()),e.css("display","block");var n=new window.Ill.LightBoxOptions;n.boxClass="quiz",n.closeButton=!0;n=new window.Ill.LightBoxPopup(n);n.on("beforeShow",function(){var t;t=e,C.get("/learningcenter/lessons/:id/kanji_flashcards_setup3".replace(":id",f()),function(e){t.find(".js-lsn3-kanji-quiz-html").html(e)})}),n.on("onClose",function(){e.find(".js-lsn3-kanji-quiz").html(""),t.prop("disabled",!1)}),n.show(e)}),"#lc_kanji_flashcards_setup"===window.location.hash&&C(".js-lsn3-take-kanji-quiz").trigger("click");var r=[];C(".js-lsn3-vocabulary-slideshow").click(function(e){C(this).focus();var n=C(this).data("title"),a=C(this).data("image");r&&r.length?Slideshow.init(n,a,r):Slideshow.load(function(t){C.get("/learningcenter/lessons/:id/vocabulary".replace(":id",f()),function(e){return e&&e.words&&0!==e.words.length?(r=e.words,void t(n,a,e.words)):(alert("An error has occurred"),void Slideshow.close())},"json").fail(function(){alert("An error has occurred"),Slideshow.close()})})}),C(".js-lsn3-dialogue ul").each(function(){C(this).find("li:first a").trigger("click")}),C(".js-lsn3-vocabulary ul li:first a").trigger("click");function l(){C(".lsn3-lesson-audio:visible").length?C("body").addClass("sticky-audio-player"):C("body").removeClass("sticky-audio-player")}function e(e,o){(e=C("[data-player="+C(e).data("control")+"]")).closest(".mejsill__audio").length||(e.closest(".lsn3-lesson-audio").removeClass("lsn3-hidden lsn3-hidden--main-audio"),l(),e.mediaelementplayer({pluginPath:"/static/js/mediaelementjs/build/",classPrefix:"mejsill__",stretching:"responsive",jumpForwardInterval:15,skipBackInterval:15,videoVolume:"ill",audioVolume:"ill",startVolume:1,alwaysShowControls:!0,speeds:["3","2","1.75","1.5","1.25","1","0.75","0.5"],defaultSpeed:"1",enableProgressTooltip:!1,features:["skipback","playpause","jumpforward","speed","volume","current","progress","duration","download","help"],signupIsRequired:t,signupClass:"js-lsn3-show-sign-up",signinIsRequired:n&&!s,signinClass:"js-show-sign-in-form",signinText:"Please sign in",upgradeUrl:"/member/member_upnewapi.php",upgradeText:"Upgrade to Basic or Premium to access these great study resources",duration:C(this).data("duration"),playText:"Play",pauseText:"Pause",isVideo:!1,success:function(e,t){var n,a=mejs.players[C(e).closest(".mejsill__container").attr("id")]?C(e).closest(".mejsill__container").attr("id"):e.id,s=C("[data-control="+C(t).data("player")+"]"),r=!!s.closest(".r101-headline__intro").length,i=C("#"+a).closest(".lsn3-lesson-audio");s.attr("aria-controls",a),s.on("click",function(){e.paused?(e.play(),C(".lsn3-lesson-audio").not(i).addClass("lsn3-hidden"),i.removeClass("lsn3-hidden lsn3-hidden--main-audio")):(e.pause(),r&&i.addClass("lsn3-hidden--main-audio")),l()}),C(e).on("play",function(){illTimeTracking.onStartPlayer(e.id),s.addClass("playing")}),"function"==typeof window.GALocalEventTracking&&C(t).data("trackurl")&&(C(e).one("play",function(){GALocalEventTracking(["_trackEvent","media","playaudio,"+p(),C(t).data("trackurl")],!1)}),void 0!==mejs.players[a].controls&&mejs.players[a].controls.find(".mejsill__download-button a").one("click",function(){GALocalEventTracking(["_trackEvent","media","downloadaudio,"+p(),C(t).data("trackurl")],!1)})),C(e).on("playing",function(){s.addClass("playing")}),C(e).on("pause",function(){illTimeTracking.onStopPlayer(e.id),s.removeClass("playing")}),C(e).on("ended",function(){illTimeTracking.onStopPlayer(e.id),s.removeClass("playing")}),C(".lsn3-lesson-audio").not(i).addClass("lsn3-hidden"),i.removeClass("lsn3-hidden"),l(),o&&(e.load(),e.play()),r&&(n=s.height(),C(document).on("scroll.lsn3m resize.lsn3m orientationchange.lsn3m",function(){!e.paused||C(document).scrollTop()>s.offset().top+n?i.removeClass("lsn3-hidden--main-audio"):i.addClass("lsn3-hidden--main-audio"),l()})),setTimeout(function(){mejs.players[a].resetSize()},100)}}))}var o,c,d,u,h;if(C(".js-lsn3-play-lesson-audio").each(function(){C(this).one("click",function(){e(C(this),!0)})}),C(".r101-headline__intro .js-lsn3-play-lesson-audio").length&&(o=C(".r101-headline__intro .js-lsn3-play-lesson-audio:first"),c=C(".js-lsn3-play-lesson-audio:first").height(),C(document).on("scroll.lsn3 resize.lsn3 orientationchange.lsn3",function(){C(document).scrollTop()>o.offset().top+c&&(C(document).off("scroll.lsn3 resize.lsn3 orientationchange.lsn3"),e(o,!1))}),C(document).scrollTop()>o.offset().top+c&&(C(document).off("scroll.lsn3 resize.lsn3 orientationchange.lsn3"),e(o,!1))),C(".js-lsn3-main-video-player").each(function(){var e=C(this).data("upgradeText")||"Upgrade your subscription to access these great study resources";C(this).mediaelementplayer({pluginPath:"/static/js/mediaelementjs/build/",classPrefix:"mejsill__",stretching:"ill",jumpForwardInterval:15,skipBackInterval:15,videoVolume:"ill",audioVolume:"ill",startVolume:1,alwaysShowControls:!1,speeds:["3","2","1.75","1.5","1.25","1","0.75","0.5"],defaultSpeed:"1",enableProgressTooltip:!1,features:["skipback","playpause","jumpforward","speed","volume","current","progress","duration","tracks","hdtoggle","fullscreen","download","help"],defaultVideoHeight:400,iPhoneUseNativeControls:!0,AndroidUseNativeControls:!0,hdToggleLocked:!a,hdUpgradeUrl:"/member/member_upnewapi.php",signupIsRequired:t,signupClass:"js-lsn3-show-sign-up",signinIsRequired:n&&!s,signinClass:"js-show-sign-in-form",signinText:"Please sign in",upgradeUrl:"/member/member_upnewapi.php",upgradeText:e,toggleCaptionsButtonWhenOnlyOne:!0,duration:C(this).data("duration"),playText:"Play",pauseText:"Pause",isVideo:!0,success:function(t,e){var n=mejs.players[C(t).closest(".mejsill__container").attr("id")]?C(t).closest(".mejsill__container").attr("id"):t.id,a=C("[data-control="+C(e).data("player")+"]"),s=C("#"+n).closest(".lsn3-lesson-video");a.attr("aria-controls",n),a.hasClass("js-video-vocab")?a.on("click",function(){s.is(":visible")?(t.pause(),s.addClass("lsn3-hidden"),a.text("Video Vocab")):(s.removeClass("lsn3-hidden"),a.text("Hide Video Vocab"),void 0!==mejs.players[n]&&mejs.players[n].resetSize(),t.play()),l()}):a.on("click",function(){var e=C("#"+n).closest(".lsn3-lesson-video");t.paused?(t.play(),e.removeClass("lsn3-hidden")):(t.pause(),e.addClass("lsn3-hidden")),l()}),C(t).on("play",function(){illTimeTracking.onStartPlayer(t.id),C(".lsn3-lesson-audio").addClass("lsn3-hidden"),a.addClass("playing"),l()}),"function"==typeof window.GALocalEventTracking&&C(e).data("trackurl")&&(C(t).one("play",function(){GALocalEventTracking(["_trackEvent","media","playvideo,"+p(),C(e).data("trackurl")],!1)}),void 0!==mejs.players[n]&&void 0!==mejs.players[n].controls&&mejs.players[n].controls.find(".mejsill__download-button a").one("click",function(){GALocalEventTracking(["_trackEvent","media","downloadvideo,"+p(),C(e).data("trackurl")],!1)})),C(t).on("playing",function(){C(".lsn3-lesson-audio").addClass("lsn3-hidden"),a.addClass("playing"),l()}),C(t).on("pause",function(){illTimeTracking.onStopPlayer(t.id),a.removeClass("playing")}),C(t).on("ended",function(){illTimeTracking.onStopPlayer(t.id),a.removeClass("playing")}),setTimeout(function(){void 0!==mejs.players[n]&&mejs.players[n].resetSize()},100)}})}),C(".js-lsn3-vocabulary-switcher").change(function(){var e=C(this).data("transliteration");if(this.checked){C(".js-lsn3-vocabulary-switcher").not("[data-transliteration="+e+"]").prop("checked",!1),C(".js-lsn3-vocabulary-switcher[data-transliteration="+e+"]").not(this).prop("checked",!0);try{localStorage.transliteration=e}catch(e){console.log("Unable to use localStorage in private mode.")}switch(e){case"romaji":case"romanization":C(".lsn3-lesson-vocabulary__pronunciation").hide(),C(".lsn3-lesson-vocabulary__transcription, .lsn3-lesson-vocabulary__romanization").show();break;case"traditional":case"kana":case"vowelled":C(".lsn3-lesson-vocabulary__transcription, .lsn3-lesson-vocabulary__romanization").hide(),C(".lsn3-lesson-vocabulary__pronunciation").show()}}else{if(C(".js-lsn3-vocabulary-switcher[data-transliteration="+e+"]").not(this).prop("checked",!1),localStorage.transliteration===e)try{localStorage.transliteration="none"}catch(e){console.log("Unable to use localStorage in private mode.")}switch(e){case"romaji":case"romanization":C(".lsn3-lesson-vocabulary__transcription, .lsn3-lesson-vocabulary__romanization").hide();break;case"traditional":case"kana":case"vowelled":C(".lsn3-lesson-vocabulary__pronunciation").hide()}}}),localStorage.transliteration?("none"===localStorage.transliteration?C(".js-lsn3-vocabulary-switcher").prop("checked",!1):C(".js-lsn3-vocabulary-switcher[data-transliteration="+localStorage.transliteration+"]").prop("checked",!0)).trigger("change"):C(".js-lsn3-vocabulary-switcher[data-transliteration=kana]").length?C(".js-lsn3-vocabulary-switcher[data-transliteration=kana]").prop("checked",!0).trigger("change"):C(".js-lsn3-vocabulary-switcher[data-transliteration=romanization]").length&&C(".js-lsn3-vocabulary-switcher[data-transliteration=romanization]").prop("checked",!0).trigger("change"),C(".js-lsn3-vocabulary-checkbox").change(function(){var e=C(".lsn3-lesson-vocabulary__definition"),t=C(".lsn3-lesson-vocabulary__tr--english");if(this.checked){C(".js-lsn3-vocabulary-checkbox[data-transliteration=english]").not(this).prop("checked",!0);try{localStorage.english="show"}catch(e){console.log("Unable to use localStorage in private mode.")}t.show(),e.show()}else{C(".js-lsn3-vocabulary-checkbox[data-transliteration=english]").not(this).prop("checked",!1);try{localStorage.english="hide"}catch(e){console.log("Unable to use localStorage in private mode.")}t.hide(),e.hide()}}),localStorage.english)("hide"===localStorage.english?C(".js-lsn3-vocabulary-checkbox[data-transliteration=english]").prop("checked",!1):C(".js-lsn3-vocabulary-checkbox[data-transliteration=english]").prop("checked",!0)).trigger("change");else{try{localStorage.english="show"}catch(e){console.log("Unable to use localStorage in private mode.")}C(".js-lsn3-vocabulary-checkbox[data-transliteration=english]").prop("checked",!0).trigger("change")}C(".js-lsn3-vocabulary-list-checkbox-all").change(function(){C(".js-lsn3-vocabulary-list-checkbox").prop("checked",this.checked)}),C(".js-lsn3-vocabulary-list-checkbox").change(function(){this.checked||C(".js-lsn3-vocabulary-list-checkbox-all").prop("checked",!1)}),C(".js-lsn3-lesson-vocabulary-list-add-to-wordbank").click(function(){var e=C(this),t=[];C(".js-lsn3-vocabulary-list-checkbox").each(function(){this.checked&&0<parseInt(C(this).data("word-id"))&&t.push(parseInt(C(this).data("word-id")))}),0!=t.length?(e.prop("disabled",!0),C.post("/api/vocabulary/addToWordBankByIds",{ids:t},function(){alert("Words added successfully!")},"json").fail(function(){alert("An error has occurred. Add words to wordbank #1")}).always(function(){e.prop("disabled",!1)})):alert("No words selected.")}),s&&"undefined"!=typeof flashcards_sync_url&&"undefined"!=typeof flashcards_user_data&&((d=C(".js-lsn3-vocabulary-list-add-to-flashcard-deck")).attr("disabled",!0),d.attr("title","Fetching Flashcard decks..."),u=flashcards_sync_url,h=flashcards_user_data,C.post(u+"getactivedecks",h,function(e){e.decks?(C.each(e.decks,function(e,t){d.append(C("<option></option>").attr("value",t.id).text(t.title))}),d.attr("disabled",!1),d.removeAttr("title")):e.noReg?(d.attr("disabled",!1),d.removeAttr("title")):(d.attr("title","Couldn't load Flashcard decks."),console.log("Couldn't load Flashcard decks."))},"json").fail(function(){d.attr("title","Couldn't load Flashcard decks."),console.log("Couldn't load Flashcard decks.")}),d.focus(function(){this.selectedIndex=0}),d.change(function(){var e=C(this).val(),t="Enter new deck name...",n="",a=[];if(C(".js-lsn3-vocabulary-list-checkbox").each(function(){this.checked&&0<parseInt(C(this).data("vocab-id"))&&a.push(parseInt(C(this).data("vocab-id")))}),0!=a.length){var s={vocabIds:a};if(""==e){if(""===(n=prompt("Add to Flashcard Deck",t))||n===t)return void alert("Invalid deck name.");if(null==n)return;s.deckTitle=n}else n=C(this).find("option:selected").text(),s.deckId=e;d.attr("disabled",!0),d.attr("title","Waiting..."),C.ajax({url:d.data("newdeckrequesturl"),data:s,dataType:"json",type:"POST"}).always(function(){d.attr("disabled",!1),d.removeAttr("title")}).done(function(e){e&&e.deny?alert("Error E003. Please try again."):e&&e.exists?alert("Error E002. '"+n+"' already exists."):e&&e.deck?(s.deckId||d.append(C("<option></option>").attr("value",e.deck).text(n)),alert(parseInt(a.length)+" items added to the deck '"+n+"'")):alert("Error E001. Please try again.")}).fail(function(){alert("Error E004. Please refresh the page and try again.")}),this.selectedIndex=0}else alert("No words selected.")})),C(".js-lsn3-record-voice").click(function(){var c="ill-microphone-is-rejected";C(this).focus();var d={audio:!0,video:!1},u=C(".js-lsn3-recorder").clone().removeClass("js-lsn3-recorder"),n=C(this).data("url"),a=C(this).data("text"),s=C(this).data("english-text"),r=C(this).data("line"),e=C(this).data("lang"),i=C(this).data("prev"),h=C(this).data("next"),p=C(this).data("prev-next-text"),f=C(this).data("rtl"),v=!!C(this).data("romanization"),t=new window.Ill.LightBoxOptions;t.boxClass="recorder",t.closeButton=!0;var o,l=new window.Ill.LightBoxPopup(t),g=null,m=[],b=!1,w=new MutationObserver(function(){var e;u.find(".js-vr-compare-text-block").length&&(e=(e=u.find(".js-vr-compare-text-block"))[0].currentStyle||window.getComputedStyle(e[0]),(o=u.find(".js-vr-compare-text-block-inner")[0].clientHeight>parseInt(e.minHeight))?u.find(".js-vr-expand-block-button").addClass("show"):u.find(".js-vr-expand-block-button").removeClass("show"),u.find(".js-vr-compare-english-text").attr("tabindex",o&&"line-by-line"===r?"-1":"0"))});function j(){u.find(".js-lsn3-recorder-html").html(C("#lesson_voice_recorder_template").html().replace(/{{:text}}/g,a).replace(/{{:english-text}}/g,s).replace(/{{:url}}/g,n).replace(/{{:prev-next-text}}/g,p).replace(/{{:lang}}/g,e).replace(/{{:line}}/g,r));var o=u.find(".js-vr-audio-record")[0],l=u.find(".js-vr-audio-example")[0];!function e(){var t=document.getElementsByClassName("js-r101-recorder-b")[0];t?w.observe(t,{childList:!0,subtree:!0}):window.setTimeout(e,500)}(),f&&(u.find(".js-vr-text").attr("dir","rtl"),"line-by-line"===r&&u.find(".js-vr-text").css("text-align","right")),u.find(".js-vr-text").children().addClass(v?"r101-recorder-b__romanization":"ill101-language-word"),i?u.find(".js-r101-recorder-b-button-prev").on("click",function(){var e=C("."+i);n=e.data("url"),a=e.data("text"),s=e.data("english-text"),r=e.data("line"),i=e.data("prev"),h=e.data("next"),p=e.data("prev-next-text"),f=e.data("rtl"),j()}):u.find(".js-r101-recorder-b-button-prev").attr("disabled",!0),h?u.find(".js-r101-recorder-b-button-next").on("click",function(){var e=C("."+h);n=e.data("url"),a=e.data("text"),s=e.data("english-text"),r=e.data("line"),i=e.data("prev"),h=e.data("next"),p=e.data("prev-next-text"),f=e.data("rtl"),j()}):u.find(".js-r101-recorder-b-button-next").attr("disabled",!0),u.find(".js-vr-expand-block-button").on("click",function(){b?(b=!1,u.find(".js-vr-compare-text-block").removeClass("r101-recorder-b__compare-text-block--expand")):(b=!0,u.find(".js-vr-compare-text-block").addClass("r101-recorder-b__compare-text-block--expand")),u.find(".js-vr-compare-english-text").attr("tabindex",b?"0":"-1"),u.find(".js-vr-expand-block-button").attr("aria-label",b?"Collapse Block":"Expand Block"),_(b?u.find(".js-vr-compare-english-text"):u.find(".js-vr-expand-block-button"))}),u.find(".js-vr-audio-example-btn").on("click",function(){var e=C(this);e.hasClass("pause")?(t(),u.find(".js-vr-audio-equalizer-compare-example").removeClass("play"),l.paused||l.pause()):l.play().then(function(){e.addClass("pause"),e.removeClass("play"),u.find(".js-vr-audio-equalizer").addClass("play"),u.find(".js-vr-audio-equalizer-compare-example").addClass("play")}).catch(function(e){console.warn(e)})}),u.find(".js-vr-audio-track").on("click",function(e){var t,n=l.duration,a=u.find(".js-vr-audio-track");return 0<n&&(t=a.offset(),t=e.clientX-t.left,a=a.width(),l.currentTime=n*t/a),!1}),l.onplay=function(){l.addEventListener("timeupdate",function(){var e=u.find(".js-vr-audio-track").width()*l.currentTime/l.duration;u.find(".js-vr-audio-played-track").css("width",e+"px"),u.find(".js-vr-audio-track-slider").css("left",e-7+"px")})},l.onpause=function(){t(),u.find(".js-vr-audio-equalizer-compare-example").removeClass("play"),"Stop"===u.find(".js-vr-compare-btn").text()&&(o.currentTime=0,o.play().then(function(){u.find(".js-vr-audio-record-btn").addClass("pause").removeClass("play"),u.find(".js-vr-audio-equalizer-compare-record").addClass("play")}).catch(function(e){u.find(".js-vr-compare-btn").text("Compare"),console.warn(e)}))};var t=function(){u.find(".js-vr-audio-example-btn").removeClass("pause").addClass("play"),u.find(".js-vr-audio-equalizer").removeClass("play")};u.find(".js-vr-audio-record-btn").on("click",function(){var e=C(this);e.hasClass("pause")?(e.removeClass("pause"),e.addClass("play"),u.find(".js-vr-audio-equalizer-compare-record").removeClass("play"),o.paused||o.pause()):o.play().then(function(){e.addClass("pause"),e.removeClass("play"),u.find(".js-vr-audio-equalizer-compare-record").addClass("play")}).catch(function(e){console.warn(e)})}),o.onpause=function(){u.find(".js-vr-audio-record-btn").removeClass("pause").addClass("play"),u.find(".js-vr-compare-btn").text("Compare"),u.find(".js-vr-audio-equalizer-compare-record").removeClass("play")},u.find(".js-vr-compare-btn").on("click",function(){var e=C(this);"Compare"===e.text()?(l.currentTime=0,l.play().then(function(){e.text("Stop"),u.find(".js-vr-audio-example-btn").removeClass("play").addClass("pause"),u.find(".js-vr-audio-equalizer-compare-example").addClass("play")}).catch(function(e){console.warn(e)})):(e.text("Compare"),l.paused||l.pause(),o.paused||o.pause())}),u.find(".js-vr-record-btn").on("click",function(){var t=C(this),n=u.find(".js-r101-recorder-b"),a=u.find(".js-recording-background"),s=u.find(".js-r101-recorder-crumbs-item-mic"),r=u.find(".js-r101-recorder-crumbs-item-play"),i=u.find(".js-vr-record-btn-text");t.hasClass("r101-recorder-b__record-button--to-record")?(u.find(".js-vr-compare-btn").text("Compare"),C("audio,video").each(function(){try{this.paused||this.pause()}catch(e){console.warn(e)}}),l.currentTime=0,navigator.mediaDevices.getUserMedia(d).then(function(e){t.removeClass("r101-recorder-b__record-button--to-record"),t.addClass("r101-recorder-b__record-button--to-stop"),n.addClass("r101-recorder-b--recording"),n.removeClass("r101-recorder-b--compare"),a.addClass("show"),s.addClass("active"),r.removeClass("active"),i.html("Stop recording"),g=new MediaRecorder(e),m=[],g.addEventListener("stop",function(){var e=new Blob(m,{type:"audio/wav"});m=[],o.src&&window.URL.revokeObjectURL(o.src),o.src=window.URL.createObjectURL(e),o.load(),g.stream.getTracks().forEach(function(e){e.stop()})}),g.addEventListener("dataavailable",function(e){m.push(e.data)}),g.start()}).catch(function(e){"NotAllowedError"===e.name?(localStorage.setItem(c,"1"),k()):(console.warn(e),y())})):(t.removeClass("r101-recorder-b__record-button--to-stop"),t.addClass("r101-recorder-b__record-button--to-record"),n.removeClass("r101-recorder-b--recording"),n.addClass("r101-recorder-b--compare"),a.removeClass("show"),r.addClass("active"),i.html("Re-record"),g.stop()),_()}),_()}function _(e){(void 0!==e?C(e):u.find(".js-vr-record-btn")).focus()}function y(){var e=new window.UAParser,t="Your device does not have a microphone we can use. Try accessing this feature on a different device or connecting a microphone.",n=e.getOS(),e=e.getBrowser();"iOS"!==n.name&&"Mac OS"!==n.name||~e.name.indexOf("Safari")||(t="The "+e.name+" browser on "+n.name+" cannot be used with the device microphone. Please use Safari to access this feature."),u.find(".js-lsn3-recorder-html").html(C("#lesson_vr_not_supported_template").html().replace(/{{:text}}/g,t))}function k(){u.find(".js-lsn3-recorder-html").html(C("#lesson_vr_permission_rejected_template").html()),u.find(".js-vr-allow-btn").on("click",function(){navigator.mediaDevices.getUserMedia(d).then(function(){localStorage.setItem(c,""),j()}).catch(function(e){"NotAllowedError"!==e.name&&(console.warn(e),y())})}),u.find(".js-vr-reject-btn").on("click",function(){l.close()})}if(l.on("onShow",function(){u.find(".js-lsn3-recorder-html").attr("aria-hidden","true"),_()}),l.on("onClose",function(){u.find(".js-lsn3-recorder-html").html(""),g&&"recording"===g.state&&g.stop(),w.disconnect(),window.Ill.mtShow()}),l.on("beforeShow",function(){u.css("display","block"),window.Ill.mtHide()}),C("audio,video").each(function(){try{this.paused||this.pause()}catch(e){console.warn(e)}}),!function(){if("undefined"==typeof MediaRecorder)return!1;if(window.URL=window.URL||window.webkitURL,!window.URL)return!1;if(void 0!==navigator.mediaDevices)return!0;var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return!!a&&(navigator.mediaDevices={getUserMedia:function(n){return new Promise(function(e,t){a.call(navigator,n,e,t)})}},!0)}())return y(),void l.show(u);function x(){var n=localStorage.getItem(c);return new Promise(function(e){var t={};t.state=null===n?"prompt":"1"===n?"denied":"granted",e(t)})}(navigator.permissions&&navigator.permissions.query?navigator.permissions.query({name:"microphone"}).catch(function(e){return console.warn(e),x()}):x()).then(function(e){return"granted"===e.state?j():"prompt"===e.state?(u.find(".js-lsn3-recorder-html").html(C("#lesson_vr_permission_pending_template").html()),u.find(".js-vr-allow-btn").on("click",function(){navigator.mediaDevices.getUserMedia(d).then(function(){localStorage.setItem(c,""),j()}).catch(function(e){"NotAllowedError"===e.name?(localStorage.setItem(c,"1"),k()):(console.warn(e),y())})}),u.find(".js-vr-reject-btn").on("click",function(){localStorage.setItem(c,"1"),l.close()})):k(),l.show(u),navigator.mediaDevices.getUserMedia(d)}).then(function(){localStorage.setItem(c,"")}).catch(function(e){"NotAllowedError"===e.name?(localStorage.setItem(c,"1"),k()):(console.warn(e),y())})}),C(".js-lsn3-vocabulary-toggle-examples").toggle(function(){C(this).text(C(this).data("hide")),C(this).closest("tr").find(".js-lsn3-vocabulary-examples").show(),C(this).attr("aria-expanded","true"),C(this).closest("tr").find(".js-lsn3-vocabulary-examples .js-lsn3-tabindex").attr("tabindex","0")},function(){C(this).text(C(this).data("show")),C(this).closest("tr").find(".js-lsn3-vocabulary-examples").hide(),C(this).attr("aria-expanded","false"),C(this).closest("tr").find(".js-lsn3-vocabulary-examples .js-lsn3-tabindex").attr("tabindex","-1")});new IllMarkLessonComplete(".js-complete"),new IllFavouritesLessons(".js-favorite",null,null,null,!0);C(".js-lsn3-accordion").click(function(){var e=C(this),t=C(this).closest("header").next(),n=C("input,select,textarea,button,object,*[href],*[tabindex],area"),a=e.parent().find(".lsn3-show-hide-a span");"true"===e.attr("aria-expanded")?(e.attr("aria-expanded","false"),t.attr("aria-hidden","true"),n.each(function(){this.hasAttribute("tabindex")&&C(this).data("tabindex",C(this).attr("tabindex")),C(this).attr("tabindex","-1")}),t.hide(),a.text("Show")):(e.attr("aria-expanded","true"),t.attr("aria-hidden","false"),n.each(function(){void 0!==C(this).data("tabindex")?(C(this).attr("tabindex",C(this).data("tabindex")),C(this).removeData("tabindex")):C(this).removeAttr("tabindex")}),t.show(),a.text("Hide"))}),setTimeout(function(){C.getScript("https://s7.addthis.com/js/300/addthis_widget.js#domready=1").fail(function(){C(".r101-headline__icn--share").attr("disabled",!0)})},100),"function"==typeof window.GALocalEventTracking&&(C("#pdfs a[data-trackurl], .lsn3-button--controls a[data-trackurl]").on("click",function(){GALocalEventTracking(["_trackEvent","media","downloadpdf,"+p(),C(this).data("trackurl")],!1)}),C("#download-center a[data-trackurl]").on("click",function(){"mp3"!==C(this).data("trackurl").substr(-3)?GALocalEventTracking(["_trackEvent","media","downloadvideo,"+p(),C(this).data("trackurl")],!1):GALocalEventTracking(["_trackEvent","media","downloadaudio,"+p(),C(this).data("trackurl")],!1)})),C(".js-lsn3-collection-nav").on("change",function(){location.href=this.value})},window.Ill.lesson.destroy=function(){C(document).off("scroll.lsn3m resize.lsn3m orientationchange.lsn3m"),C(document).off("scroll.lsn3 resize.lsn3 orientationchange.lsn3")},C(window.Ill.lesson.init)}(jQuery),function(a){var s=13,r=27;window.Ill||(window.Ill={}),window.Ill.dropdown||(window.Ill.dropdown={}),window.Ill.dropdown.init=function(){a(".js-show-dropdown-tooltip").on({click:function(e){var t=a(this),n=t.siblings(".js-tooltip");a(this).hasClass("js-show-tooltip--level")||n.css({top:t.position().top-n.outerHeight()-8,left:t.position().left-n.width()/2+t.outerWidth()/2}),t.toggleClass("active"),n.toggle(1,function(){a(this).is(":visible")?(t.attr("aria-expanded","true"),n.attr("tabindex","0"),n.find("[tabindex]").attr("tabindex","0"),n.focus()):(t.attr("aria-expanded","false"),n.attr("tabindex","-1"),n.find("[tabindex]").attr("tabindex","-1"))}),e.preventDefault()},focusout:function(){var e=a(this),t=e.siblings(".js-tooltip");t.data("submenuTimer",setTimeout(function(){e.removeClass("active"),t.hide()},0))},focusin:function(){var e=a(this).siblings(".js-tooltip");clearTimeout(e.data("submenuTimer"))}}),a(".js-tooltip").on({focusout:function(){var e=a(this),t=e.siblings(".js-show-dropdown-tooltip");e.data("submenuTimer",setTimeout(function(){t.removeClass("active"),e.hide(1,function(){t.attr("aria-expanded","false"),e.attr("tabindex","-1")})},0))},focusin:function(){clearTimeout(a(this).data("submenuTimer"))},keydown:function(e){var t=a(this),n=t.siblings(".js-show-dropdown-tooltip");e.which===r&&(n.removeClass("active"),t.hide(1,function(){n.attr("aria-expanded","false"),t.attr("tabindex","-1")}),e.preventDefault()),e.which===s&&(n.removeClass("active"),t.hide(1,function(){n.attr("aria-expanded","false"),t.attr("tabindex","-1")}))},click:function(){var e=a(this),t=e.siblings(".js-show-dropdown-tooltip");t.removeClass("active"),e.hide(1,function(){t.attr("aria-expanded","false"),e.attr("tabindex","-1")})}})},a(window.Ill.dropdown.init)}(jQuery),function(t){var n,a,e,s,r,i,o,l=navigator.userAgent;function c(){n.setAttribute("content",e),s=!0}/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(l)&&-1<l.indexOf("AppleWebKit")&&((l=t.document).querySelector&&(l=(n=l.querySelector("meta[name=viewport]"))&&n.getAttribute("content"),a=l+",maximum-scale=1",e=l+",maximum-scale=10",s=!0,n&&(t.addEventListener("orientationchange",c,!1),t.addEventListener("devicemotion",function(e){o=e.accelerationIncludingGravity,r=Math.abs(o.x),i=Math.abs(o.y),o=Math.abs(o.z),t.orientation&&180!==t.orientation||!(7<r||(6<o&&i<8||o<8&&6<i)&&5<r)?s||c():s&&(n.setAttribute("content",a),s=!1)},!1))))}(this);