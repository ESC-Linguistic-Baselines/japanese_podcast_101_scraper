!function(d){d.fn.illProgressBar=function(r,e,s,t){return this.each(function(){t=!1!==t,d(this).data("colors",t),d(this).data("total",e),d(this).data("complete",s),d(this).on("illupdate",function(e,s){var t=d(this).find(".js-progress-done, .r101-progress__done"),o=parseInt(d(this).data("total")),i=parseInt(d(this).data("complete")),l=d(this).data("colors"),a=0,n="";void 0!==s&&(void 0!==s.c?i=parseInt(s.c):i+=parseInt(s)),0===i||0===o?a=0:o<=i?a=100:100<=(a=Math.ceil(i/o*100))&&(a=99),a<0&&(a=0),100<a&&(a=100),t.css("width",a+"%"),l&&(n=a<30?"#f27a73":a<90?"#f8ad55":"#9bcb7d",t.css("background-color",n));n=r.replace(/\{([pct])\}/g,function(e,s){switch(s){case"p":return a;case"c":return i;case"t":return o}});d(this).find(".js-progress-text, .r101-progress__inline").text(n)})}),this.trigger("illupdate"),this}}(jQuery),function(a){var n=window.Slideshow={index:0,timer:0,playlist:[],currentAudio:null,currentAudioIndex:0,visible:!1,isStart:!0,playingAudio:!1,autoplay:!1,words:[],sessionId:0,mobile:a.browser.mobile,ios:!!a(".itsios").length,showTarget:"word",playEnglish:!0,playSample:!0,loop:!0,fullscreen:!1,slow:!0,lightBox:null,bind:function(s,e,t){a(".js-slideshow-start-button").click(function(){n.start(e,t)}),a(".js-slideshow-prev-button").click(function(){n.pause(),n.prev()}),a(".js-slideshow-next-button").click(function(){n.pause(),n.next()}),a(".js-slideshow-pause-button").click(function(){n.pause()}),a(".js-slideshow-play-button").click(function(){n.play()}),a(".js-slideshow-fast-button").click(function(){n.slow=!1,n.updateIntervalButtons(),n.autoplay||n.play()}),a(".js-slideshow-slow-button").click(function(){n.slow=!0,n.updateIntervalButtons(),n.autoplay||n.play()}),a(".js-slideshow-loop-button").click(function(){n.loop=!n.loop,n.updateLoopSwitchers()}),a(".js-slideshow-nightmode-button").click(function(){var e=!s.hasClass("nightmode");a(this).attr("aria-checked",e?"true":"false"),s.toggleClass("nightmode",e),a(this).toggleClass("active",e)}),a(".js-slideshow-fullscreen-button").click(function(){var e=!s.hasClass("fullscreen");a(this).attr("aria-checked",e?"true":"false"),n.fullscreen=e,s.toggleClass("fullscreen",e),a(this).toggleClass("active",e),e||n.lightBox.align()})},load:function(e){var s,o;n.loading||n.visible||(n.loading=!0,n.show(),s=n.sessionId=Math.random(),o=s,e(function(e,s,t){n.visible&&n.sessionId===o&&(n.init(e,s,t),n.loading=!1)}))},init:function(e,s,t){n.visible&&!n.loading||(n.words=t,n.fullscreen=!1,n.show(e,s))},show:function(s,t){function o(){a(".js-slideshow-list-title").text(s);var e=1<n.words.length?"s":"";a(".js-slideshow-list-info").text(n.words.length+" Word"+e),a(".js-slideshow-list-image").attr("src",t),a(".js-slideshow-list-image").parent()[t?"show":"hide"](),a(".js-slideshow-list-image").parent().next()[t?"addClass":"removeClass"]("slideshow__info-cell--first-slide"),a(".js-slideshow-progress").illProgressBar("{c} of {t}",n.words.length,0),a(".js-slideshow-spinner").fadeOut(500)}var i,e;s&&n.visible&&o(),n.visible||(i=a(".js-slideshow-popup"),(e=new window.Ill.LightBoxOptions).boxClass="slideshow",e.closeButton=!0,e.additionalControls=['<button class="r101-button-nightmode slideshow__nightmode js-slideshow-nightmode-button" aria-label="Nightmode" role="checkbox" aria-checked="false"></button>','<button class="r101-button-fullscreen slideshow__fullscreen js-slideshow-fullscreen-button" aria-label="Fullscreen" role="checkbox" aria-checked="false"></button>'],this.lightBox=new window.Ill.LightBoxPopup(e),this.lightBox.on("beforeShow",function(e){n.visible=!0,n.isStart=!0,s?o():a(".js-slideshow-spinner").show(),n.toggleScreens(!0,0),n.bind(e,i.data("rtl"),i.data("lang"))}),this.lightBox.on("onClose",function(){n.close()}),this.lightBox.show(i.html()))},toggleScreens:function(e,s){var t=a(".js-slideshow-start"),o=a(".js-slideshow-slide");s=void 0!==s?s:500,e?(o.hide(),t.fadeIn(s).css("display","table-cell")):(t.hide(),o.fadeIn(s).css("display","table-cell")),this.lightBox.align()},start:function(e,s){n.isStart&&(n.index=0,n.showTarget=a(".js-slideshow-show-radio:checked").val(),n.playEnglish=a(".js-slideshow-play-english-checkbox").is(":checked"),n.playSample=a(".js-slideshow-play-sample-checkbox").is(":checked"),n.loop=a(".js-slideshow-loop-checkbox").is(":checked"),n.updateLoopSwitchers(),n.updateIntervalButtons(),n.updateControls(n.index),n.renderCurrent(e,s),n.chainAudios(),n.playAudio(),n.play(),n.isStart=!1,n.toggleScreens(!1))},play:function(){a(".js-slideshow-play-button").hide(),a(".js-slideshow-pause-button").show(),n.autoplay=!0,n.playingAudio||n.setTimer()},pause:function(){a(".js-slideshow-play-button").show(),a(".js-slideshow-pause-button").hide(),n.autoplay=!1},close:function(){n.currentAudio&&n.currentAudio.pause(),clearTimeout(n.timer),n.sessionId=0,n.visible=!1,n.loading&&(n.loading=!1)},updateIntervalButtons:function(){var e=a(".js-slideshow-slow-button");e.toggleClass("checked",n.slow),e.attr("aria-checked",n.slow?"true":"false");e=a(".js-slideshow-fast-button");e.toggleClass("checked",!n.slow),e.attr("aria-checked",n.slow?"false":"true")},updateLoopSwitchers:function(){var e=a(".js-slideshow-loop-button");e.toggleClass("checked",n.loop),e.attr("aria-checked",n.loop?"true":"false"),a(".js-slideshow-loop-checkbox").prop("checked",n.loop)},setTimer:function(e,s){s=void 0===s?n.slow?3e3:500:s,e=void 0===e?n.checkNext:e,n.timer=setTimeout(function(){e()},s)},next:function(){n.index<n.words.length-1?(n.updateControls(++n.index),n.renderCurrent(),n.chainAudios(),n.playAudio()):n.loop?(n.index=-1,n.next()):(n.isStart=!0,n.toggleScreens(!0))},prev:function(){n.index<=0&&n.loop&&(n.index=n.words.length),0<n.index&&(n.updateControls(--n.index),n.renderCurrent(),n.chainAudios(),n.playAudio())},updateControls:function(e){a(".js-slideshow-progress").trigger("illupdate",{c:e+1}),a(".js-slideshow-prev-button").prop("disabled",!n.loop&&0===e),a(".js-slideshow-next-button").prop("disabled",!n.loop&&e===n.words.length-1)},renderCurrent:function(e,s){var t=n.words[n.index];n.playlist=[],a(".js-slideshow-class").html(t.class),t.audio&&n.createAudio(t.audio);var o=t.target,i=!1;"romanization"===n.showTarget&&(t.romaji||t.romanization)?(o=t.romaji||t.romanization,i=!0):"kana"===n.showTarget&&t.kana?o=t.kana:"traditional"===n.showTarget&&t.traditional&&(o=t.traditional);o=a(".js-slideshow-word").html(o);s&&(i?o.attr("dir","ltr").removeAttr("lang"):o.attr("dir",e?"rtl":"ltr").attr("lang",s)),t.image&&-1===t.image.indexOf("img_placeholder")?(l=(o=a(".js-slideshow-image")).clone().attr("src",-1===t.image.indexOf(".jpg")&&-1===t.image.indexOf(".png")?t.image+"_96square.jpg":t.image),o.removeAttr("src").replaceWith(l),a(".js-slideshow-no-image").removeClass("no-image")):a(".js-slideshow-no-image").addClass("no-image"),n.playEnglish&&t.audioEnglish&&n.createAudio(t.audioEnglish),a(".js-slideshow-english").html(t.english);var l=null;t.samples&&t.samples.length?l=t.samples[0]:t.phrases&&t.phrases.length&&(l=t.phrases[0]),l?(t=l.target,i=!1,"romanization"===n.showTarget&&(l.romaji||l.romanization)?(t=l.romaji||l.romanization,i=!0):"kana"===n.showTarget&&l.kana?t=l.kana:"traditional"===n.showTarget&&l.traditional&&(t=l.traditional),a(".js-slideshow-sample-target").html(t),a(".js-slideshow-sample-english").html(l.english),n.playSample&&l.audio&&(n.createAudio(l.audio),n.playEnglish&&l.audioEnglish&&n.createAudio(l.audioEnglish))):(a(".js-slideshow-sample-target").html(""),a(".js-slideshow-sample-english").html("")),s&&(i?a(".js-slideshow-sample-target").attr("dir","ltr").removeAttr("lang"):a(".js-slideshow-sample-target").attr("dir",e?"rtl":"ltr").attr("lang",s))},checkNext:function(){n.autoplay&&n.next()},createAudio:function(e){var s;n.currentAudio||((s=document.createElement("audio")).src=e,s.preload="auto",n.ios&&s.addEventListener("timeupdate",function(){this.duration==this.currentTime&&this.onended()}),s.addEventListener("error",function(e){}),n.currentAudio=s),(s=document.createElement("audio")).src=e,s.preload="auto",n.playlist.push(s)},chainAudios:function(){clearTimeout(n.timer),n.currentAudio&&n.currentAudio.pause(),n.playlist.length&&(n.currentAudio.onended=n.currentAudio.onerror=function(e){n.currentAudioIndex++,n.currentAudioIndex<n.playlist.length?(n.currentAudio.src=n.playlist[n.currentAudioIndex].src,n.mobile?n.currentAudio.play():n.setTimer(function(){n.currentAudio.play()},n.slow?1e3:500)):(n.playingAudio=!1,n.ios?n.checkNext():n.setTimer())})},playAudio:function(){n.currentAudio&&n.currentAudio.pause(),n.playlist.length?(n.playingAudio=!0,n.currentAudio.src=n.playlist[0].src,n.currentAudio.play(),n.currentAudioIndex=0):n.setTimer()}}}(jQuery);